apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: lidarr
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://media-servarr.shw.al/charts
    chart: lidarr
    targetRevision: 0.4.0  # chart version
    helm:
      values: |
        # --- Runtime UID/GID etc (must be under deployment.container.env for this chart) ---
        deployment:
          container:
            env:
              - name: PUID
                value: "1000"
              - name: PGID
                value: "1000"
              - name: TZ
                value: "America/Denver"

        # --- Lidarr base URL; set '' if you want it at '/' instead of '/lidarr/' ---
        application:
          urlBase: ""
          port: 8686

        # --- Ingress config for this chart ---
        ingress:
          enabled: true
          ingressClassName: traefik
          host: lidarr.theblacklodge.dev
          annotations:
            cert-manager.io/cluster-issuer: letsencrypt-dns
          tls:
            - secretName: lidarr-tls
              hosts:
                - lidarr.theblacklodge.dev

        # you still need volumes / PVCs as appropriate (config, downloads, music)
        # see the chart README for examples
  destination:
    server: "https://kubernetes.default.svc"
    namespace: media
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
