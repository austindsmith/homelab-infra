# Main site playbook - Complete K3s cluster deployment
# Run with: ansible-playbook site.yml

# Phase 1: System Preparation
- import_playbook: configurations/disable-firewall.yml
- import_playbook: updates/all-updates.yml

# Phase 2: K3s Installation
- import_playbook: applications/install-k3s.yml

# Phase 2.5: Install NFS utilities
- import_playbook: applications/install-nfs-utils.yml

# Phase 3: Networking Configuration
- import_playbook: applications/configure-networking.yml

# Phase 4: Fetch Kubeconfig
- import_playbook: applications/fetch-kubeconfig.yml

# Phase 5: Deploy All Applications
- import_playbook: applications/deploy-all-apps.yml

# Phase 6: Fix Application Issues
- import_playbook: applications/fix-postgresql-permissions.yml

# Phase 7: Optimize Storage and Cleanup
- import_playbook: applications/optimize-storage-and-cleanup.yml

# Phase 8: Fix All Application Issues
- import_playbook: applications/fix-all-application-issues.yml

# Phase 5: Validation (optional, comment out if not needed)
# - import_playbook: validate-cluster.yml

# Phase 6: ArgoCD Bootstrap (optional, run separately if preferred)
# - import_playbook: applications/bootstrap-argocd.yml