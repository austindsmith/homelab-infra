version: "3.8"

services:
  wazuh_dashboard:
    image: wazuh/wazuh-dashboard:${VERSION}
    hostname: ${WAZUH_DASHBOARD_NODE}
    restart: always
    user: "0:0"
    environment:
      WAZUH_DASHBOARD_PASSWORD: ${WAZUH_DASHBOARD_PASSWORD}
      WAZUH_API_USER: ${WAZUH_API_USER}
      WAZUH_API_PASS: ${WAZUH_API_PASS}
    volumes:
      - dashboard-config:/etc/wazuh-dashboard
    networks: [wazuh_net]
    ports:
      - "5601:5601"
    command: >
      sh -c 'set -e;
      mkdir -p /etc/wazuh-dashboard;
      cat >/etc/wazuh-dashboard/opensearch_dashboards.yml <<EOF
      server.host: "0.0.0.0"
      server.port: 5601
      server.ssl.enabled: false
      opensearch.hosts: ["http://wazuh.indexer:9200"]
      opensearch.ssl.verificationMode: none
      opensearch.username: "admin"
      opensearch.password: "${WAZUH_DASHBOARD_PASSWORD}"
      wazuh.api.url: "http://wazuh.manager:55000"
      wazuh.api.username: "${WAZUH_API_USER}"
      wazuh.api.password: "${WAZUH_API_PASS}"
      EOF
      exec /usr/share/wazuh-dashboard/bin/opensearch-dashboards --allow-root'


  # placeholders so depends_on resolves; remove if these services live in another stack
  wazuh_manager:
    image: alpine
    command: ["sh","-c","sleep infinity"]
    networks: [wazuh_net]
  wazuh_indexer:
    image: alpine
    command: ["sh","-c","sleep infinity"]
    networks: [wazuh_net]

volumes:
  dashboard-config:

networks:
  wazuh_net:
    driver: bridge
