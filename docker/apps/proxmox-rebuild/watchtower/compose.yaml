# docker-compose.yml
version: "3.9"

services:
  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    restart: unless-stopped
    environment:
      - TZ=America/Denver
      # Only update containers explicitly labeled for watchtower
      - WATCHTOWER_LABEL_ENABLE=true
      # Remove old images after successful update
      - WATCHTOWER_CLEANUP=true
      # Stagger restarts to avoid blast radius
      - WATCHTOWER_ROLLING_RESTART=true
      # Run daily at 04:15 local time (CRON: m h dom mon dow)
      - WATCHTOWER_SCHEDULE=15 4 * * *
      # Optional notifications (Shoutrrr). Example: Discord webhook
      - WATCHTOWER_NOTIFICATIONS=shoutrrr
      - WATCHTOWER_NOTIFICATION_URL=smtp://dale.cooper%40theblacklodge.org:451RM9CPHP9DKD8G@smtp.protonmail.ch:587/?fromAddress=dale.cooper%40theblacklodge.org&toAddresses=austindsmith_accounts%40proton.me
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
